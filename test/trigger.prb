
[auto_atoms]

[trigger t]
[res [t : *x] [show *x]]

[TestEq "Initial ZERO" [0.0 12800.0 0.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t keyon 65 11]
[TestEq "Immediately after trigger" [0.0 12800.0 0.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[MoveCore]
[TestEq "After first move" [128.0 1408.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t keyon 66 12]
[t keyon 68 14]
[TestEq "After two new keyons" [128.0 1408.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[MoveCore]
[TestEq "After second move" [512.0 1408.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t keyoff 68]
[TestEq "After keyoff" [512.0 1408.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[MoveCore]
[TestEq "After third move" [256.0 1408.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t keyoff]
[TestEq "After all keyoff" [256.0 1408.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[MoveCore]
[TestEq "After fourth move" [256.0 1408.0 0.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]

[t keyoff] [MoveCore]
[t "porta" 1] [t "time" 100] [t "legato" 1]

[TestEq "Another Initial ZERO" [256.0 1408.0 0.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t keyon 63 16]
[TestEq "Legato ON 1" [256.0 1408.0 0.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[MoveCore]
[TestEq "Legato ON 2" [-128.0 2048.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t keyon 62 32]
[TestEq "Legato ON 3 (velocity preserved)" [-128.0 2048.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[MoveCore]
[TestWorks "Ramp down...." [t "key" *k1] [MoveCore] [t "key" *k2] [MoveCore] [t "key" *k3] [show [> -128.0 *k1 *k2 *k3]] [> -128.0 *k1 *k2 *k3]]

[t keyoff] [t keyon 64 64] [MoveCore]
[TestEq "Reset with velocity 8192" [0.0 8192.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t keyoff]
[TestEq ".... make sure nothing changed" [0.0 8192.0 1.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[MoveCore]
[TestEq "only the trigger = 0.0" [0.0 8192.0 0.0] [*key *velocity *trigger] [t "key" *key] [t "velocity" *velocity] [t "trigger" *trigger]]
[t "legato" 0] [t keyon 65 100] [MoveCore]
[TestWorks "Now with legato OFF" [t "key" *k1] [MoveCore] [t "key" *k2] [MoveCore] [t "key" *k3] [show [< 0.0 *k1 *k2 *k3]] [< 0.0 *k1 *k2 *k3]]

[exit]
